# SACS 多目标优化流程图结构描述

## 视觉风格指南（卡通化插画风格）

### 整体风格特点
- **风格**: 卡通化、扁平化但带有少量阴影和细节的插画风格
- **色彩**: 鲜明、对比度高，易于区分不同模块
- **线条**: 清晰、黑色描边，增强辨识度
- **图标**: 拟人化、友好，降低技术门槛

### 颜色方案

#### 主色调
- **蓝色系**: 
  - 主蓝色: #4A90E2 (用于LLM、模型相关)
  - 浅蓝色: #87CEEB (用于处理步骤)
  - 深蓝色: #2E5C8A (用于强调)
  
- **橙色系**:
  - 主橙色: #FF8C42 (用于评估、分析相关)
  - 浅橙色: #FFA500 (用于评估步骤)
  - 深橙色: #E67E22 (用于强调)
  
- **绿色系**:
  - 成功绿: #52C41A (用于成功、输出)
  - 浅绿色: #90EE90 (用于开始/结束)
  
- **红色系**:
  - 错误红: #FF4D4F (用于失败、错误)
  - 警告红: #FF6347 (用于警告)
  
- **中性色**:
  - 白色: #FFFFFF (背景、图标主体)
  - 浅灰: #F5F5F5 (次要背景)
  - 深灰: #333333 (文字、描边)

### 图标设计建议

#### 1. LLM/模型图标（机器人风格）
- **设计**: 拟人化卡通机器人
- **颜色**: 白色或浅灰色身体，蓝色屏幕/眼睛
- **细节**: 
  - 橙色或黄色小部件（轮子、天线、指示灯）
  - 黑色描边，厚度约2-3px
  - 少量高光和阴影（增加立体感）
- **示例标签**: "LLM Model", "Gemini-2.5-Flash", "MOLLM"

#### 2. SACS分析图标（齿轮+建筑）
- **设计**: 齿轮与建筑结构组合
- **颜色**: 橙色齿轮，蓝色建筑轮廓
- **细节**: 
  - 齿轮象征机制/分析
  - 建筑轮廓象征结构工程
  - 黑色描边，内部有纹理

#### 3. 数据库/结果图标（图表+电脑）
- **设计**: 电脑屏幕显示图表
- **颜色**: 白色/浅灰机身，屏幕显示彩色图表
- **细节**:
  - 蓝色、橙色、黄色数据条
  - 折线图或柱状图
  - 黑色描边

#### 4. 优化算法图标（大脑+齿轮）
- **设计**: 大脑与齿轮结合
- **颜色**: 粉色或橙色大脑，黄色齿轮
- **细节**:
  - 大脑象征智能/优化
  - 齿轮象征机制/算法
  - 脑回纹理，黑色描边

#### 5. 文件/配置图标（文档+齿轮）
- **设计**: 文档与设置齿轮
- **颜色**: 白色文档，蓝色齿轮
- **细节**: 简洁扁平，黑色描边

### 线条和边框风格

#### 描边规范
- **主描边**: 黑色，2-3px 厚度
- **次要描边**: 深灰色，1-2px 厚度
- **虚线框**: 用于分组或强调模块
  - 颜色: 深灰色或主题色
  - 样式: 2px 虚线，间距 4px
- **实线框**: 用于具体步骤
  - 颜色: 黑色或深灰色
  - 样式: 2-3px 实线

#### 阴影效果
- **轻微阴影**: 增加立体感但不破坏扁平化
- **参数**: 
  - 偏移: 2-3px (右下)
  - 模糊: 3-5px
  - 颜色: 半透明黑色 (rgba(0,0,0,0.1-0.2))
  - 不适用于所有元素，仅用于主要模块

### 字体规范

#### 字体选择
- **主字体**: 无衬线字体（如 Arial, Helvetica, Roboto）
- **中文**: 思源黑体、微软雅黑等现代无衬线字体
- **英文**: Arial, Helvetica, Roboto

#### 字体大小层次
- **标题**: 18-24pt，加粗
- **模型/模块名称**: 14-16pt，加粗
- **步骤描述**: 12-14pt，常规
- **详细说明**: 10-12pt，常规或细体

#### 字体颜色
- **主文字**: 深灰色 (#333333) 或黑色
- **标题**: 深灰色或主题色
- **特殊标签**: 白色（在深色背景上）

### 布局原则

#### 整体布局
- **方向**: 主要流程从左到右（水平）或从上到下（垂直）
- **对齐**: 元素之间保持良好的水平和垂直对齐
- **间距**: 统一的内外边距（建议 20-30px）
- **分组**: 使用虚线框或背景色区分不同模块

#### 流程框设计
- **形状**: 圆角矩形（圆角半径 8-12px）
- **大小**: 根据内容调整，最小宽度 120px，高度 60-80px
- **背景**: 白色或浅色，带主题色边框
- **内边距**: 10-15px

#### 决策框设计
- **形状**: 菱形（用于判断）
- **大小**: 根据内容调整
- **颜色**: 金色 (#FFD700) 或主题色
- **文字**: 加粗，居中

#### 箭头设计
- **样式**: 实心箭头，黑色或深灰色
- **粗细**: 2-3px
- **方向**: 明确指向
- **标签**: 可选，用于说明条件（如 "Yes", "No", "Continue"）

---

## 流程图 1: 主优化流程（整体框架）

### 结构布局建议
- **方向**: 从上到下（Top-Down）
- **主要流程**: 垂直排列
- **循环部分**: 右侧或左侧分支，最后回到循环起点

### 详细步骤

#### 1. 开始节点
- **形状**: 圆角矩形（开始/结束框）
- **内容**: "Start"
- **位置**: 顶部居中

#### 2. 初始化阶段（垂直排列）
- **步骤 2.1**: 加载配置
  - **内容**: "Load Configuration (Config YAML)"
  - **说明**: 读取配置文件，包括优化目标、LLM模型、SACS路径等
  
- **步骤 2.2**: 生成初始种群
  - **内容**: "Generate Initial Population (From SACS file or seeds)"
  - **说明**: 从SACS文件读取基准设计，或使用预定义种子生成初始候选方案
  
- **步骤 2.3**: 评估初始种群
  - **内容**: "Evaluate Initial Population"
  - **说明**: 对初始种群中的每个候选方案进行评估（详见流程图2）

#### 3. 优化循环（菱形决策框）
- **步骤 3.1**: 循环判断
  - **形状**: 菱形
  - **内容**: "Optimization Loop (While budget > 0)"
  - **说明**: 检查评估预算是否用完

#### 4. 循环体内部（并行分支）
- **步骤 4.1**: 选择父代
  - **内容**: "Select Parents (NSGA-II Selection)"
  - **说明**: 使用NSGA-II算法从当前种群中选择父代个体
  - **位置**: 左侧分支
  
- **步骤 4.2**: LLM生成新候选
  - **内容**: "LLM Generate (Mutation/Crossover)"
  - **说明**: 根据提示词，LLM对父代进行变异或交叉操作，生成新的候选方案
  - **位置**: 中间分支
  
- **步骤 4.3**: 解析候选方案
  - **内容**: "Parse Candidate (Extract code blocks)"
  - **说明**: 从LLM返回的JSON中提取代码块（GRUP/PGRUP或JOINT）
  - **位置**: 右侧分支

#### 5. 评估阶段（汇聚到中心）
- **步骤 5.1**: 修改SACS文件
  - **内容**: "Modify SACS File (Replace GRUP/PGRUP or JOINT)"
  - **说明**: 将候选方案的代码块替换到SACS输入文件中
  - **位置**: 左侧
  
- **步骤 5.2**: 运行SACS分析
  - **内容**: "Run SACS Analysis (WSL Environment)"
  - **说明**: 在WSL环境中调用SACS分析引擎执行结构分析
  - **位置**: 中间
  
- **步骤 5.3**: 提取结果
  - **内容**: "Extract Results (Weight, UC values)"
  - **说明**: 从SACS数据库文件中提取结构重量和应力比（UC）值
  - **位置**: 右侧

#### 6. 计算目标值（汇聚）
- **步骤 6**: 计算目标值
  - **内容**: "Calculate Objectives (Weight, Axial_UC_max, Bending_UC_max)"
  - **说明**: 计算三个优化目标：总重量、最大轴向应力比、最大弯曲应力比

#### 7. 更新种群
- **步骤 7**: 更新种群
  - **内容**: "Update Population (NSGA-II)"
  - **说明**: 使用NSGA-II算法更新种群，保留非支配解

#### 8. 循环返回
- **箭头**: 从"更新种群"返回到"优化循环"判断
- **标签**: "Continue" 或 "预算未用完"

#### 9. 输出结果
- **步骤 9**: 保存结果
  - **内容**: "Save Results (PKL, JSON, Model Files)"
  - **说明**: 保存优化历史、最终种群、最优解等

#### 10. 结束节点
- **形状**: 圆角矩形
- **内容**: "End"
- **位置**: 底部居中

---

## 流程图 2: 详细评估流程（单个候选方案评估）

### 结构布局建议
- **方向**: 从上到下
- **决策点**: 菱形框
- **成功路径**: 左侧（绿色）
- **失败路径**: 右侧（红色）

### 详细步骤

#### 1. 接收候选
- **内容**: "Receive Candidate (JSON string)"
- **说明**: 接收LLM生成的候选方案（JSON格式字符串）

#### 2. 解析JSON
- **内容**: "Parse JSON (Extract code blocks)"
- **说明**: 解析JSON字符串，提取"new_code_blocks"字典

#### 3. 过滤代码块
- **内容**: "Filter Code Blocks"
- **说明**: 
  - 截面优化：只保留GRUP_*和PGRUP_*开头的块
  - 几何优化：只保留JOINT_*开头的块

#### 4. 备份原文件
- **内容**: "Backup Original SACS File"
- **说明**: 创建SACS输入文件的备份

#### 5. 修改SACS文件
- **内容**: "Modify SACS File (Replace blocks)"
- **说明**: 在SACS输入文件中查找并替换对应的代码块

#### 6. 运行SACS分析
- **内容**: "Run SACS Analysis (WSL)"
- **说明**: 在WSL环境中执行SACS结构分析

#### 7. 决策点（菱形）
- **内容**: "Analysis Successful?"
- **说明**: 检查SACS分析是否成功完成

#### 8. 成功路径（左侧，绿色）
- **步骤 8.1**: 提取重量
  - **内容**: "Extract Weight (From DB)"
  - **说明**: 从SACS数据库计算结构总重量
  
- **步骤 8.2**: 提取UC值
  - **内容**: "Extract UC Values (From DB)"
  - **说明**: 从SACS数据库提取所有杆件的应力比
  
- **步骤 8.3**: 计算目标
  - **内容**: "Calculate Objectives (Weight, Axial_UC_max, Bending_UC_max)"
  - **说明**: 计算三个优化目标值
  
- **步骤 8.4**: 返回结果
  - **内容**: "Return Results (Weight, Axial_UC, Bending_UC)"
  - **说明**: 返回评估结果，包括原始值、转换值、可行性等

#### 9. 失败路径（右侧，红色）
- **步骤 9**: 分配惩罚
  - **内容**: "Assign Penalty (Invalid/Failed)"
  - **说明**: 对于失败或无效的候选方案，分配惩罚分数

---

## 关键连接关系

### 主流程图中的连接
1. **顺序连接**: 开始 → 加载配置 → 生成初始种群 → 评估初始种群 → 优化循环
2. **并行分支**: 选择父代、LLM生成、解析候选（三个并行）
3. **汇聚**: 三个并行分支汇聚到评估阶段
4. **循环**: 更新种群 → 预算判断 → (继续) → 选择父代
5. **结束**: 预算判断 → (结束) → 保存结果 → 结束

### 评估流程图中的连接
1. **顺序连接**: 接收候选 → 解析 → 过滤 → 备份 → 修改 → 运行
2. **决策分支**: 运行分析 → 成功判断 → (成功/失败)
3. **成功路径**: 提取重量 → 提取UC → 计算目标 → 返回结果
4. **失败路径**: 成功判断 → (失败) → 分配惩罚

---

## 详细颜色和图标映射

### 主流程图 - 卡通风格设计

#### 1. 开始节点
- **图标**: 绿色圆形开始按钮（带播放符号）
- **背景**: 浅绿色 (#90EE90)
- **描边**: 深绿色，3px
- **文字**: "Start"，深绿色，加粗

#### 2. 加载配置
- **图标**: 文档+齿轮组合（白色文档，蓝色齿轮）
- **背景**: 白色
- **描边**: 蓝色 (#4A90E2)，2px
- **文字**: "Load Configuration"，深灰色

#### 3. 生成初始种群
- **图标**: 大脑+齿轮（粉色大脑，黄色齿轮）
- **背景**: 浅蓝色 (#E6F3FF)
- **描边**: 蓝色 (#4A90E2)，2px
- **文字**: "Generate Initial Population"，深灰色

#### 4. 评估初始种群
- **图标**: 图表+电脑（橙色图表，白色电脑）
- **背景**: 浅橙色 (#FFF4E6)
- **描边**: 橙色 (#FF8C42)，2px
- **文字**: "Evaluate Initial Population"，深灰色

#### 5. 优化循环（决策框）
- **形状**: 菱形
- **图标**: 循环箭头（橙色）
- **背景**: 金色 (#FFD700)
- **描边**: 深橙色，3px
- **文字**: "Budget > 0?"，深灰色，加粗

#### 6. 选择父代
- **图标**: 大脑+图表（粉色大脑，蓝色图表）
- **背景**: 浅蓝色 (#E6F3FF)
- **描边**: 蓝色 (#4A90E2)，2px
- **文字**: "Select Parents (NSGA-II)"，深灰色

#### 7. LLM生成
- **图标**: 卡通机器人（白色身体，蓝色屏幕，橙色轮子）
- **背景**: 浅蓝色 (#E6F3FF)
- **描边**: 蓝色 (#4A90E2)，2px
- **文字**: "LLM Generate (Mutation/Crossover)"，深灰色
- **特殊**: 可以添加"Gemini-2.5-Flash"标签

#### 8. 解析候选
- **图标**: 文档+代码符号（白色文档，蓝色代码）
- **背景**: 浅蓝色 (#E6F3FF)
- **描边**: 蓝色 (#4A90E2)，2px
- **文字**: "Parse Candidate"，深灰色

#### 9. 修改SACS文件
- **图标**: 齿轮+文档（橙色齿轮，白色文档）
- **背景**: 浅橙色 (#FFF4E6)
- **描边**: 橙色 (#FF8C42)，2px
- **文字**: "Modify SACS File"，深灰色

#### 10. 运行SACS分析
- **图标**: 齿轮+建筑（橙色齿轮，蓝色建筑）
- **背景**: 浅橙色 (#FFF4E6)
- **描边**: 橙色 (#FF8C42)，2px
- **文字**: "Run SACS Analysis (WSL)"，深灰色

#### 11. 提取结果
- **图标**: 数据库+图表（蓝色数据库，橙色图表）
- **背景**: 浅橙色 (#FFF4E6)
- **描边**: 橙色 (#FF8C42)，2px
- **文字**: "Extract Results"，深灰色

#### 12. 计算目标值
- **图标**: 计算器+图表（蓝色计算器，橙色图表）
- **背景**: 浅橙色 (#FFF4E6)
- **描边**: 橙色 (#FF8C42)，2px
- **文字**: "Calculate Objectives"，深灰色

#### 13. 更新种群
- **图标**: 大脑+齿轮（粉色大脑，黄色齿轮）
- **背景**: 浅蓝色 (#E6F3FF)
- **描边**: 蓝色 (#4A90E2)，2px
- **文字**: "Update Population (NSGA-II)"，深灰色

#### 14. 保存结果
- **图标**: 文件夹+图表（绿色文件夹，蓝色图表）
- **背景**: 浅绿色 (#E6F9E6)
- **描边**: 绿色 (#52C41A)，2px
- **文字**: "Save Results"，深灰色

#### 15. 结束节点
- **图标**: 红色圆形停止按钮（带停止符号）
- **背景**: 浅红色 (#FFE6E6)
- **描边**: 红色 (#FF4D4F)，3px
- **文字**: "End"，深红色，加粗

### 评估流程图 - 卡通风格设计

#### 成功路径（绿色系）
- **背景**: 浅绿色 (#E6F9E6)
- **描边**: 绿色 (#52C41A)，2px
- **图标**: 勾选标记、图表、数据库

#### 失败路径（红色系）
- **背景**: 浅红色 (#FFE6E6)
- **描边**: 红色 (#FF4D4F)，2px
- **图标**: 警告标记、X符号

#### 决策点（菱形）
- **背景**: 金色 (#FFD700)
- **描边**: 深橙色，3px
- **图标**: 问号或判断符号

---

## 文字说明框（可选）

可以在流程图旁边或下方添加说明框，包括：
- **优化目标**: 最小化重量、轴向应力比、弯曲应力比
- **约束条件**: UC <= 1.0（可行性约束）
- **算法**: NSGA-II（非支配排序遗传算法）
- **LLM操作**: 变异（Mutation）、交叉（Crossover）
- **评估环境**: WSL + SACS CONNECT Edition

---

## 布局建议

### 主流程图布局
```
        [Start]
           |
    [Load Config]
           |
  [Generate Init Pop]
           |
  [Evaluate Init Pop]
           |
    [Optimization Loop] ←──────┐
           |                   |
    ┌──────┴──────┐            |
    |      |      |            |
[Select] [LLM] [Parse]        |
    |      |      |            |
    └──────┴──────┘            |
           |                   |
    [Modify SACS]              |
           |                   |
    [Run Analysis]             |
           |                   |
    [Extract Results]          |
           |                   |
  [Calculate Objectives]       |
           |                   |
    [Update Population]        |
           |                   |
    [Budget > 0?] ─────────────┘
           |
      [Save Results]
           |
         [End]
```

### 评估流程图布局
```
    [Receive Candidate]
           |
      [Parse JSON]
           |
   [Filter Blocks]
           |
    [Backup File]
           |
   [Modify SACS]
           |
   [Run Analysis]
           |
   [Successful?]
         / \
        /   \
    Yes     No
     |       |
[Extract] [Penalty]
     |
[Calculate]
     |
[Return Results]
```

---

## 绘制工具建议

### 专业工具
1. **Adobe Illustrator**: 矢量图，适合专业插画
2. **Figma**: 在线协作，适合团队
3. **Sketch**: Mac平台，适合UI/插画设计
4. **Inkscape**: 免费开源矢量图工具

### 在线工具
1. **Draw.io (diagrams.net)**: 免费，支持多种图标库
2. **Lucidchart**: 专业流程图工具
3. **Miro**: 协作白板，适合快速原型

### 图标资源
1. **Flaticon**: 免费图标库（需注明来源）
2. **Icons8**: 图标库，支持多种风格
3. **Noun Project**: 高质量图标库
4. **Material Icons**: Google Material Design图标

### 绘制步骤建议
1. **第一步**: 用简单形状搭建框架（矩形、菱形）
2. **第二步**: 添加图标（从图标库选择或自定义绘制）
3. **第三步**: 应用颜色方案（统一主题色）
4. **第四步**: 添加描边和阴影（增强立体感）
5. **第五步**: 添加文字标签（清晰易读）
6. **第六步**: 调整布局和间距（保持整洁）
7. **第七步**: 添加箭头和连接线（明确流程）

## 论文中的使用建议

1. **主流程图**: 放在"Methodology"或"Algorithm"章节，展示整体优化框架
2. **评估流程图**: 放在"Evaluation"或"Experimental Setup"章节，说明如何评估候选方案
3. **可以合并**: 将评估流程图作为主流程图中的一个子模块（用一个框表示"Evaluate Candidate"）
4. **风格统一**: 确保所有流程图使用相同的视觉风格和颜色方案
5. **图标一致性**: 相同功能的模块使用相同的图标（如所有LLM相关都用机器人图标）

## 示例布局（卡通风格）

### 主流程图布局建议
```
[Start] (绿色圆形按钮图标)
   ↓
[Load Config] (文档+齿轮图标，蓝色边框)
   ↓
[Generate Init Pop] (大脑+齿轮图标，蓝色边框)
   ↓
[Evaluate Init Pop] (图表+电脑图标，橙色边框)
   ↓
[Optimization Loop?] (菱形，金色背景，循环箭头图标)
   ↓ (Yes)
   ├─→ [Select Parents] (大脑+图表图标，蓝色边框)
   ├─→ [LLM Generate] (机器人图标，蓝色边框)
   └─→ [Parse Candidate] (文档+代码图标，蓝色边框)
         ↓ (汇聚)
   [Modify SACS] (齿轮+文档图标，橙色边框)
         ↓
   [Run Analysis] (齿轮+建筑图标，橙色边框)
         ↓
   [Extract Results] (数据库+图表图标，橙色边框)
         ↓
   [Calculate Obj] (计算器+图表图标，橙色边框)
         ↓
   [Update Population] (大脑+齿轮图标，蓝色边框)
         ↓
   ←── [Loop] (返回箭头，红色虚线)
         ↓ (No)
   [Save Results] (文件夹+图表图标，绿色边框)
         ↓
[End] (红色圆形按钮图标)
```

### 评估流程图布局建议
```
[Receive Candidate] (文档图标，蓝色边框)
   ↓
[Parse JSON] (代码图标，蓝色边框)
   ↓
[Filter Blocks] (筛选图标，蓝色边框)
   ↓
[Backup File] (文件夹图标，灰色边框)
   ↓
[Modify SACS] (齿轮+文档图标，橙色边框)
   ↓
[Run Analysis] (齿轮+建筑图标，橙色边框)
   ↓
[Successful?] (菱形，金色背景，问号图标)
   / \
  Yes No
   |   |
[Extract] [Penalty] (图表图标，绿色边框) (X图标，红色边框)
   |
[Calculate]
   |
[Return Results] (勾选图标，绿色边框)
```

